(function(){$.msgBox=function(title,msg,callback){if(msg&&typeof msg==="function"){callback=msg;}
GenerateHtml(title,msg);btnOk(callback);btnNo();};$.msgBox.mini=function(txt,time,callback){var str="<div id='msgBoxMini'></div>";$('body').append(str);var msgBoxMini=$('#msgBoxMini'),_time=1400;if(time&&typeof time=='number')_time=time;msgBoxMini.css({'min-height':'18px','min-width':'100px','position':'fixed','left':'50%','top':'50%','z-index':'9999','font-size':'16px','padding':'40px 50px','border-radius':'4px','box-shadow':'0px 0px 12px 2px #aaa','background':'rgba(121,208,206,.9)','color':'#fff','border':'3px solid #f9f9f9','text-align':'center'});var _w=msgBoxMini.outerWidth(true),_h=msgBoxMini.outerHeight(true);msgBoxMini.css({'margin-left':-_w/2,'margin-top':-_h/2});this.show=(function(){msgBoxMini.text(txt);msgBoxMini.show();setTimeout(function(){msgBoxMini.fadeOut(function(){msgBoxMini.remove();if(typeof time=='function'){time();}else if(typeof callback=='function'){callback();}});},_time);})();};var GenerateHtml=function(title,msg){var _html="";_html+='<div id="mb_box"></div><div id="mb_con"><span id="mb_tit">'+title+'</span>';if(msg&&typeof msg!=="function"){_html+='<div id="mb_msg">'+msg+'</div>';}else{_html+='<textarea style="resize:none;" placeholder="请输入信息" id="mb_text" row="3"></textarea>';}
_html+='<div id="mb_btnbox">';if(msg&&typeof msg=="function"){_html+='<input id="mb_btn_no" type="button" value="取消" />';}
_html+='<input id="mb_btn_ok" type="button" value="确定" />';_html+='</div></div>';$("body").append(_html);GenerateCss();};var GenerateCss=function(){$("#mb_box").css({width:'100%',height:'100%',zIndex:'99999',position:'fixed',filter:'Alpha(opacity=60)',backgroundColor:'black',top:'0',left:'0',opacity:'0.6'});$("#mb_con").css({zIndex:'999999',width:'340px',position:'fixed',backgroundColor:'White',borderRadius:'10px'});$("#mb_tit").css({display:'block',fontSize:'14px',color:'#444',padding:'10px 15px',backgroundColor:'#DDD',borderRadius:'10px 10px 0 0',borderBottom:'3px solid #009BFE',fontWeight:'bold'});$("#mb_msg").css({padding:'40px 20px',lineHeight:'20px',color:"#444",borderBottom:'1px dashed #DDD',fontSize:'13px',textAlign:'center'});$("#mb_text").css({padding:'10px',lineHeight:'20px',color:"#444",height:'60px',width:'250px',margin:"10px 35px",border:'none',fontSize:'14px',outline:'none',overflow:'auto',borderBottom:'1px dashed #DDD'});$("#mb_btnbox").css({margin:'15px 0 10px 0',textAlign:'center'});$("#mb_btn_ok,#mb_btn_no").css({width:'85px',height:'30px',color:'white',border:'none',backgroundColor:'#168bbb',cursor:'pointer'});$("#mb_btn_no").css({"marginRight":"30px",background:"#ddd",color:"#666"});var _widht=document.documentElement.clientWidth;var _height=document.documentElement.clientHeight;var boxWidth=$("#mb_con").width();var boxHeight=$("#mb_con").height();$("#mb_con").css({top:(_height-boxHeight)/2+"px",left:(_widht-boxWidth)/2+"px"});};var btnOk=function(callback){$("#mb_btn_ok").on('click',function(){_msgTxt=$("#mb_text").val();$("#mb_box,#mb_con").remove();if(typeof(callback)==='function'){callback();}
return _msgTxt;});};var btnNo=function(){$("#mb_btn_no").on('click',function(){$("#mb_box,#mb_con").remove();return false;});};})();$(function(){var getCodeBtn=$('.getcode-btn'),empty_phone=$('.empty-phone'),empty_inputs=$('.empty-code-box input'),pwf_next=$('.pwf-next'),pwf_btn=$('.pwf-true'),empty_newpw=$('.empty-newpw'),empty_pwagin=$('.empty-pwagin'),remeber_ts=$('.get-code').find('.sign-warning'),ts_txt=remeber_ts.find('span'),validpw=false,valid_bool=false;getCodeBtn.on('click',function(){var _txt=empty_phone.val();if(valid_bool){$.post('/account/send_verify_message',{'phone':_txt},function(e){$.msgBox.mini('验证码发送成功，请注意查收!',function(){empty_inputs.eq(0).focus();});});}else{remeber_ts.fadeIn();}});empty_phone.on('keyup',function(e){var _this=$(this),kc=e.keyCode,_txt=_this.val(),reg=/^1[3-8]+\d{9}$/;valid_bool=false;if(_txt.length==11){if(_txt&&reg.test(_txt)){$.post('/account/check_phone',{'phone':_txt},function(e){result=JSON.parse(e);if(result['status']=='TRUE'){remeber_ts.hide();valid_bool=true;}else{ts_txt.text('手机号未被注册');remeber_ts.fadeIn();valid_bool=false;}});}else{ts_txt.text('手机号格式不正确');remeber_ts.fadeIn();}}});function testPhone(){}
empty_inputs.attr('maxlength',1);empty_inputs.on('keyup',function(e){var _this=$(this),_txt=_this.val(),kc=e.keyCode;if(kc>=48&&kc<=57){_this.next().focus();}});pwf_next.on('click',function(){var codeNum='';var phone=empty_phone.val()
for(var i=0;i<empty_inputs.length;i++){codeNum+=empty_inputs.eq(i).val();}
$.post('/account/pwd_checkcode',{'phone':phone,'code':codeNum},function(e){result=JSON.parse(e);if(result['status']=='TRUE'){$('.pwf-setnew ').show();$('.pwf-underline').animate({'left':330});$('.find-cont').animate({'left':-280});}else{$.msgBox.mini('验证码输入错误');}});});empty_newpw.on('blur',function(){var _this=$(this),_txt=_this.val(),reg=/^[a-zA-Z0-9_]{6,18}$/,_new=empty_newpw.val(),_agin=empty_pwagin.val();if(reg.test(_txt)){if(_new==_agin){validpw=true;_this.removeClass('active');$('.newpw-ts').hide();}else{validpw=false;$('.aginpw-ts').fadeIn();empty_pwagin.addClass('active');}
_this.removeClass('active');$('.newpw-ts').hide();}else{validpw=false;_this.addClass('active');$('.newpw-ts').fadeIn();}});empty_pwagin.on('blur',function(){var _this=$(this),_new=empty_newpw.val(),_agin=empty_pwagin.val();if(_new==_agin){validpw=true;_this.removeClass('active');$('.aginpw-ts').hide();}else{validpw=false;_this.addClass('active');$('.aginpw-ts').fadeIn();}});pwf_btn.on('click',function(){console.log(validpw);if(validpw){var new_password=empty_pwagin.val();$.post('/account/u_resetpwd',{'password':new_password},function(e){result=JSON.parse(e);if(result['status']=='FAILURE'){$.msgBox.mini('重置密码出错');}else{window.location.assign('/shop/login_register');}});}});})